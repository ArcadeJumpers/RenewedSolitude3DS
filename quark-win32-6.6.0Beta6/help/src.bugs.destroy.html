<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
  <title>Destroy-events</title>
  <meta name="Description" content="QuArK Information Database - Page: 4.7.3.&nbsp;Destroy-events">
  <meta name="Keywords" content="QuArK InfoBase Quake Army Knife QRK QKM Python PY Map Editor Hexen Heretic Half-Life Sin Kingpin Soldier-of-Fortune Star-Trek-Voyager Elite-Force">
  <link rel=stylesheet href="standard.css" type="text/css">
</head>

<body>
<a name="__top__"></a>
<table width="100%" border=0 cellspacing=0>
  <tr>
    <td width=213>
      <a target="_blank" href="http://quark.sourceforge.net/"><img src="quarkicon.png" width=213 height=90 border=0 alt="Go to QuArK Web Site"></a>
    </td>
    <td width="70%" align=center>
      <div class="topheadline">Destroy-events</div>
      <div class="sm">Updated&nbsp;09 Aug 2008</div>
    </td>
    <td width="30%" valign=bottom nowrap>
      Upper&nbsp;levels:<br>-&nbsp;<a href="index.html">QuArK&nbsp;Information&nbsp;Base</a><br>-&nbsp;<a href="src.html">4.&nbsp;The&nbsp;Source&nbsp;Code</a><br>-&nbsp;<a href="src.bugs.html">4.7.&nbsp;Known&nbsp;bugs&nbsp;in&nbsp;the&nbsp;Source&nbsp;...</a><br>
    </td>
  </tr>
</table>
<table width="100%" border=0 cellspacing=0>
  <tr class="headline">
    <td width="99%">
      <p class="headline">&nbsp;4.7.3.&nbsp;Destroy-events</p>
    </td>
    <td width="1%" align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.bugs.leaks.html">Prev</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.bugs.html">Up</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.quarkx.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
<table border=0 width="100%" cellspacing=10><tr><td>
</td></tr></table>
<br>

<table width="100%" border=0 cellspacing=0>
  <tr class="headline">
    <td width="100%">
      <p class="subheadline">&nbsp;Index</p>
    </td>
  </tr>
</table>
<ul class="index">
  <li>- <a href="#destroy">Destroy-events</a>&nbsp;<span class="added">(09 Aug 2008)</span>
</ul>
<br>


<a name="destroy"></a>
  <table width="100%" border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Destroy-events</p>
      </td>
      <td align=right>
        <font size=-2>DanielPharos&nbsp;-&nbsp;09 Aug 2008</font>
      </td>
      <td width="1%" align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width="100%" cellspacing=10><tr><td>
<p>To improve performance most forms in Delphi are recycled: They are closed,
never destroyed. The Destroy-events of forms are triggered from Delphi's own
code, when QuArK shuts down and all remaining objects are unloaded. This
however means that the Destroy-event of forms are triggered when the bulk of
the program has already been removed from memory! Specifically, the controls
are already all gone. The Destroy-event triggers the Close-event though, and
this is where the problem lies: the close-event is often not prepared for a
there-are-no-controls-situation!
</p><p>Example:
QkListview.pas, TQForm2.FormClose:
<div class="doccode"><pre>  g_Form1.AbortIdleJob(ListView1);</pre></div>
</p><p>When this is triggered from the Destroy-event, the Destroy-event of Form1 has
already run; g_Form1 is now nil! This triggers a difficult to trace access
violation, that doesn't seem to make sence or do anything harmfull expect
crash QuArK on shutdown. The workaround is putting in a check for g_Form1,
which I have done. However, maybe this should be fixed differently and all
together by running the Destroy-events on these forms BEFORE Form1/the program
shuts down!
</p><p>Another location where this (or something very similar) was happening:
Config.pas:
DisableTimer (This is to indicate that parts of the Close-event shouldn't be
run)
</p>
  </td></tr></table>
  <br>

<br>

<table width="100%" border=0 cellspacing=0>
  <tr class="headline">
    <td width="99%" align=center>
      <p class="sm">
        Copyright (c) 2009, GNU General Public License by The QuArK (Quake Army Knife) Community - <a target="_blank" href="http://quark.sourceforge.net/">http://quark.sourceforge.net/</a><br>
      </p>
    </td>
    <td width="1%" align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.bugs.leaks.html">Prev</a></span>&nbsp;-&nbsp;<a href="#__top__">Top</a>&nbsp;-&nbsp;<span class="navenable"><a href="src.quarkx.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
</body>
</html>